function Simulation(){var d=null;var c=(function(){var h={gridSize:350,milliseconds:50,patterns:null,currentPattern:-1};if(h.patterns!==null){return patterns}var g=new XMLHttpRequest();var f=window.location.origin+(window.location.port.length>0?"/source":"")+"/data/patterns.json";g.open("GET",f,true);g.onload=i;g.onerror=function(){h.patterns=[]};g.send();function i(){if(g.status>=200&&g.status<400){var n=JSON.parse(g.responseText);h.patterns=n.patterns;var k=document.getElementById("patterns"),m=document.createDocumentFragment();m.appendChild(new Option("-- select a pattern --",0));for(var l=0,j=h.patterns.length;l<j;l++){m.appendChild(new Option(h.patterns[l].name,l))}k.appendChild(m)}else{h.patterns=[]}}return{setGridSize:function(j){h.gridSize=parseInt(j)},setRefreshDelayInterval:function(j){h.milliseconds=parseInt(j)},setPattern:function(j){if(j===0){h.currentPattern=-1;return}h.currentPattern=h.patterns[j-1].points},get:h}})();var b=(function(){var g=document.getElementById("mouseCell");var i=document.getElementById("mouseIndex");var h=document.getElementById("theBoard");var f=h.getContext("2d");h.addEventListener("mouseleave",function(){g.innerText="";i.innerText=""},false);h.addEventListener("mousemove",function(m){var k=h.getBoundingClientRect();var j=Math.floor((m.clientX-k.left)/a.cellSize),n=Math.floor((m.clientY-k.top)/a.cellSize);var l=j+n*c.get.gridSize;if(l<0||l>a.lastCellIndex){g.innerText="";i.innerText=""}else{g.innerText="("+j+", "+n+")";i.innerText=l}},false);h.addEventListener("click",function(n){var q=h.getBoundingClientRect();var s=Math.floor((n.clientX-q.left)/a.cellSize),r=Math.floor((n.clientY-q.top)/a.cellSize);var p=s+r*c.get.gridSize;var t=a.cells[p];if(c.get.currentPattern===-1){return}var o=c.get.currentPattern;for(var m=0,j=o.length;m<j;m++){var k=o[m];t.toggleRelativeCell(k.x,k.y)}},false);return{setCanvasSize:function(j){h.width=j;h.height=j},clearCanvas:function(){f.clearRect(0,0,h.width,h.height)},printCell:function(j){var l=j.getCanvasLocation();var k=a.cellSize-a.borderWidth;f.fillStyle=j.state?"#88C6DB":"#fff";f.fillRect(l.left,l.top,k,k)},printGrid:function(){var k=(c.get.gridSize*a.cellSize)+a.cellOffset;this.setCanvasSize(k);for(var j=a.cellOffset;j<k;j+=a.cellSize){f.moveTo(j,0);f.lineTo(j,k-a.cellSize)}for(var l=a.cellOffset;l<k;l+=a.cellSize){f.moveTo(0,l);f.lineTo(k-a.cellSize,l)}f.strokeStyle="#ccc";f.stroke()}}})();var a={init:function(){this.cellSize=4;this.cellOffset=0.5;this.borderWidth=this.cellOffset*2;this.cells=new Array(c.get.gridSize+(c.get.gridSize*c.get.gridSize));this.lastCellIndex=this.cells.length-1;for(var f=0;f<=this.lastCellIndex;f++){this.cells[f]=new e(f)}b.clearCanvas();b.printGrid()}};var e=function(f){this.state=0;this.cellIndex=f};e.prototype.getLocation=function(){return{x:this.cellIndex%c.get.gridSize,y:Math.floor(this.cellIndex/c.get.gridSize)}};e.prototype.getCanvasLocation=function(){var f=this.getLocation();return{left:f.x*a.cellSize+a.borderWidth,top:f.y*a.cellSize+a.borderWidth}};e.prototype.getNeighbors=function(){var i,f,h,g;i=this.cellIndex-c.get.gridSize;g=this.cellIndex+c.get.gridSize;h=1;f=-1;return[i+f,i,i+h,this.cellIndex+f,this.cellIndex+h,g+f,g,g+h]};e.prototype.getLivingNeighborsCount=function(){var g=this.getNeighbors(),h=8,i=0,f=a.lastCellIndex;while(h--){var j=g[h];i+=j>0&&j<f&&a.cells[j].state?1:0}return i};e.prototype.toggleRelativeCell=function(j,k){var g=c.get.gridSize;var h=this.getLocation();var i=(h.x+j)+(h.y+k)*g;var f=a.cells[i];f.state=!f.state;b.printCell(f)};e.prototype.toggleCell=function(){this.state=!this.state;b.printCell(this)};e.prototype.doesBirthLawApply=function(){var f=this.getLivingNeighborsCount();return(f===3)};e.prototype.doesDeathLawApply=function(){var f=this.getLivingNeighborsCount();return(f>3||f<2)};return{run:function(){var g=0;this.pause();d=setInterval(f,c.get.milliseconds);function f(){var j=[],l=a.lastCellIndex+1,p=a.lastCellIndex;g++;while(l--){var n=a.cells[l];if(n.state){if(n.doesDeathLawApply()){if(j.indexOf(n)===-1){j.push(n)}}var q=n.getNeighbors();var i=8;while(--i){var m=q[i];if(m>0&&m<p){var k=a.cells[m];var h=k.state?k.doesDeathLawApply():k.doesBirthLawApply();if(h){if(j.indexOf(k)===-1){j.push(k)}}}}}}var o=j.length;while(o--){j[o].toggleCell()}}},pause:function(){clearInterval(d)},clear:function(){this.pause();a.init()},Options:c}};