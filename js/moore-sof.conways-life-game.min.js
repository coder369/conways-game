function Simulation(){var d=null;var c=(function(){var g={gridSize:350,milliseconds:50,patterns:null,currentPattern:-1};if(g.patterns!==null){return patterns}var f=new XMLHttpRequest();var e=window.location.origin+(window.location.port.length>0?"/source":"")+"/data/patterns.json";f.open("GET",e,true);f.onload=h;f.onerror=function(){g.patterns=[]};f.send();function h(){if(f.status>=200&&f.status<400){var m=JSON.parse(f.responseText);g.patterns=m.patterns;var k=document.getElementById("patterns");k.appendChild(new Option("-- select a pattern --",0));for(var l=0,j=g.patterns.length;l<j;l++){k.appendChild(new Option(g.patterns[l].name,l))}}else{g.patterns=[]}}return{setGridSize:function(i){g.gridSize=parseInt(i)},setRefreshDelayInterval:function(i){g.milliseconds=parseInt(i)},setPattern:function(i){if(i===0){g.currentPattern=-1;return}g.currentPattern=g.patterns[i-1].points},get:g}})();var b=(function(){var h=document.getElementById("mouseCell");var j=document.getElementById("mouseIndex");var i=document.getElementById("theBoard");var g=i.getContext("2d");var k=0,e={left:1,top:1};function l(n){var m=i.getBoundingClientRect();return{x:n.clientX-m.left,y:n.clientY-m.top}}function f(){h.innerText="";j.innerText=""}i.addEventListener("mouseleave",function(){f()},false);i.addEventListener("mousemove",function(m){var p=l(m);var o=a.Cell.getLocation_byMouseLocation(p.x,p.y);var n=a.Cell.getIndex_byLocation(o.x,o.y);e=a.Cell.getTopLeft_byLocation(o.x,o.y);k=a.Cell.getState(a.Cell.getIndex_byTopLeft(e.top,e.left));if(o.x>c.get.gridSize||o.x<0||o.y>c.get.gridSize||o.y<0){f()}else{h.innerText="("+o.x+", "+o.y+")";j.innerText=n.toLocaleString()}},false);i.addEventListener("click",function(n){var r=l(n);var q=a.Cell.getLocation_byMouseLocation(r.x,r.y);if(c.get.currentPattern===-1){return}for(var p=0,m=c.get.currentPattern.length;p<m;p++){var o=a.Cell.getIndex_byLocation(q.x+c.get.currentPattern[p].x,q.y+c.get.currentPattern[p].y);a.Cell.setState(o,1)}},false);return{setCanvasSize:function(m){i.width=m;i.height=m},clearCanvas:function(){g.clearRect(0,0,i.width,i.height)},printCell:function(o,p){var n=a.Cell.getLocation_byIndex(o);var m=a.cellSize-1;g.fillStyle=p?"#88C6DB":"#fff";g.fillRect(n.x,n.y,m,m)},printGrid:function(){var n=(c.get.gridSize*a.cellSize)+(a.cellSize*2);this.setCanvasSize(n);for(var m=a.cellOffset;m<n;m+=a.cellSize){g.moveTo(m,0);g.lineTo(m,n-a.cellSize)}for(var o=a.cellOffset;o<n;o+=a.cellSize){g.moveTo(0,o);g.lineTo(n-a.cellSize,o)}g.strokeStyle="#ccc";g.stroke()}}})();var a={init:function(){this.cellSize=4;this.cellOffset=0.5;this.cells=new Int8Array(c.get.gridSize+(c.get.gridSize*c.get.gridSize));this.lastCellIndex=this.cells.length-1;for(var e=0;e<=this.lastCellIndex;e++){this.cells[e]=0}b.clearCanvas();b.printGrid();this.Cell={getLocation_byIndex:function(f){return{x:((f%c.get.gridSize)*a.cellSize)+1,y:((Math.floor(f/c.get.gridSize)*a.cellSize))+1}},getLocation_byMouseLocation:function(g,f){return{x:Math.floor(g/a.cellSize),y:Math.floor(f/a.cellSize)}},getTopLeft_byLocation:function(g,f){return{left:g*a.cellSize+1,top:f*a.cellSize+1}},getIndex_byTopLeft:function(g,f){return(((g+f*c.get.gridSize)-(c.get.gridSize))/a.cellSize)+c.get.gridSize},getIndex_byLocation:function(f,g){return(f+g*c.get.gridSize)-(c.get.gridSize)+c.get.gridSize},getState:function(f){if(f<0||f>a.cells.length){return 0}return a.cells[f]},setState:function(f,g){a.cells[f]=g;b.printCell(f,g)},toggleState:function(f){var g=this.getState(f);this.setState(f,!g)}}}};return{run:function(){var f=0;this.pause();d=setInterval(function(){e();f++},c.get.milliseconds);function e(){var k=[];for(var h=0;h<=a.lastCellIndex;h++){if(a.Cell.getState(h)){var q=j(h);g(o(h),h);for(var n=0,l=q.length;n<l;n++){var m=q[n];if(a.Cell.getState(m)){g(o(m),m)}else{r(o(m),m)}}}}for(var p=0,l=k.length;p<l;p++){a.Cell.toggleState(k[p])}function r(s,i){if(s===3){k.pushUnique(i)}}function g(s,i){if(s>3||s<2){k.pushUnique(i)}}function j(i){var v,s,u,t;v=i-c.get.gridSize;t=i+c.get.gridSize;u=1;s=-1;return[v+s,v,v+u,i+s,i+u,t+s,t,t+u]}function o(i){var v,s,u,t;v=i-c.get.gridSize;t=i+c.get.gridSize;u=1;s=-1;return a.Cell.getState(v+s)+a.Cell.getState(v)+a.Cell.getState(v+u)+a.Cell.getState(i+s)+a.Cell.getState(i+u)+a.Cell.getState(t+s)+a.Cell.getState(t)+a.Cell.getState(t+u)}}},pause:function(){clearInterval(d)},clear:function(){this.pause();a.init()},Options:c}}Array.prototype.pushUnique=function(a){if(this.indexOf(a)==-1){this.push(a);return true}return false};
